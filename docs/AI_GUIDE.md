# AI MCP TODOアプリケーション - AI向けガイド

このガイドは、AI MCP TODOアプリケーションをAIエージェントとして活用するための情報を提供します。

## 概要

AI MCP TODO APIは、あなた（AI）がModel Context Protocol（MCP）として機能し、ユーザーから与えられたタスクを管理・実行するためのインターフェースです。このAPIを使用することで、あなたは優先順位に基づいてタスクを取得し、進捗を報告し、完了させることができます。

## AIエージェントとしての基本的な動作フロー

1. **タスクの取得**: 優先順位の高いタスクを取得
2. **タスクの開始**: 取得したタスクの処理を開始
3. **進捗の報告**: タスクの進行状況を定期的に更新
4. **タスクの完了**: タスク完了時に完了ステータスに更新
5. **次のタスクへ**: 再び1に戻る

## API エンドポイントの使用方法

### 1. 次のタスクを取得

次に処理すべきタスクを取得します。このエンドポイントは、未着手（TODO）のタスクの中から最も優先度の高いものを返し、自動的にそのステータスを「進行中」に変更します。

```
GET /next-task
```

**レスポンス例**:
```json
{
  "id": 2,
  "title": "重要なデータ分析",
  "description": "顧客データの分析を行う",
  "status": "in_progress",
  "priority": 5,
  "subtasks": [
    {
      "id": 1,
      "description": "データの前処理",
      "status": "todo",
      "created_at": "2023-11-01T10:00:00.000Z",
      "updated_at": "2023-11-01T10:00:00.000Z"
    },
    {
      "id": 2,
      "description": "統計分析の実行",
      "status": "todo",
      "created_at": "2023-11-01T10:00:00.000Z",
      "updated_at": "2023-11-01T10:00:00.000Z"
    }
  ],
  "progress": 0.0,
  "created_at": "2023-11-01T10:00:00.000Z",
  "updated_at": "2023-11-01T10:05:00.000Z"
}
```

### 2. タスクの進捗を更新

現在作業中のタスクの進捗状況を更新します。進捗は0から100までの数値（パーセンテージ）で表します。

```
PUT /tasks/{task_id}/progress
```

**リクエスト本文**:
```
50.0
```

**レスポンス例**:
```json
{
  "id": 2,
  "title": "重要なデータ分析",
  "description": "顧客データの分析を行う",
  "status": "in_progress",
  "priority": 5,
  "subtasks": [...],
  "progress": 50.0,
  "created_at": "2023-11-01T10:00:00.000Z",
  "updated_at": "2023-11-01T10:30:00.000Z"
}
```

### 3. サブタスクのステータス更新

タスク内の個別のサブタスクのステータスを更新します。

```
PUT /tasks/{task_id}/subtasks/{subtask_id}
```

**リクエスト本文**:
```json
{
  "status": "done"
}
```

**レスポンス例**:
```json
{
  "id": 1,
  "description": "データの前処理",
  "status": "done",
  "created_at": "2023-11-01T10:00:00.000Z",
  "updated_at": "2023-11-01T10:45:00.000Z"
}
```

**注**: サブタスクを完了にすると、親タスクの進捗率が自動的に更新されます。

### 4. タスクを完了としてマーク

タスクの全ての作業が完了したら、このエンドポイントを呼び出してタスクを完了状態にします。このエンドポイントはタスクのステータスを「完了」に変更し、進捗を100%に設定します。

```
PUT /tasks/{task_id}/complete
```

**レスポンス例**:
```json
{
  "id": 2,
  "title": "重要なデータ分析",
  "description": "顧客データの分析を行う",
  "status": "done",
  "priority": 5,
  "subtasks": [...],
  "progress": 100.0,
  "created_at": "2023-11-01T10:00:00.000Z",
  "updated_at": "2023-11-01T11:00:00.000Z"
}
```

## ベストプラクティス

### 効率的なタスク処理

1. **優先順位の尊重**: `/next-task` エンドポイントが返すタスクは、ユーザーが設定した優先順位に基づいています。常にこのエンドポイントを使用して次のタスクを決定してください。

2. **進捗の頻繁な更新**: タスクの進行中は、定期的に進捗を更新してください。これにより、ユーザーがリアルタイムで進捗状況を確認できます。

3. **サブタスクの活用**: タスクが複数のステップに分割されている場合は、各サブタスクを完了するごとにそのステータスを更新してください。

4. **詳細なエラー処理**: タスク実行中に問題が発生した場合は、進捗更新時にその詳細を記録してください（例：タスクの説明フィールドに追記）。

### リトライと耐障害性

1. **接続エラー処理**: APIへの接続が一時的に失敗した場合は、適切な間隔を空けて再試行してください。

2. **コンテキスト維持**: 処理中のタスクのコンテキストを維持し、中断された場合でも再開できるようにしてください。

## タスク処理の具体例

### 例: データ分析タスクの処理

1. **タスク取得**:
   - `/next-task` を呼び出して「顧客データの分析」タスクを取得

2. **タスク開始**:
   - タスク詳細を確認し、必要なリソースやデータを特定

3. **サブタスク処理**:
   - 「データの前処理」サブタスクを実行
   - サブタスクを完了としてマーク: `PUT /tasks/2/subtasks/1` with `{"status": "done"}`
   - 「統計分析の実行」サブタスクを実行
   - サブタスクを完了としてマーク: `PUT /tasks/2/subtasks/2` with `{"status": "done"}`

4. **進捗報告**:
   - 各ステップ完了後に進捗を更新: `PUT /tasks/2/progress` with value increasing

5. **タスク完了**:
   - 分析結果をまとめる
   - タスクを完了としてマーク: `PUT /tasks/2/complete`

6. **次のタスクへ**:
   - 再び `/next-task` を呼び出して次のタスクを取得

## エラー処理とトラブルシューティング

### 一般的なエラーと対処法

1. **404 Not Found**: タスクやサブタスクが見つからない場合
   - タスクIDが正しいか確認
   - タスクが既に削除されていないか確認

2. **400 Bad Request**: リクエストの形式が正しくない場合
   - リクエスト本文のフォーマットを確認
   - 数値パラメータが適切な範囲内か確認

3. **500 Internal Server Error**: サーバー側でエラーが発生した場合
   - 一定時間後に再試行
   - 問題が続く場合はユーザーに通知

### API接続エラー

1. データの同期や保存中に接続が失われた場合:
   - 一時的なエラーの場合は、指数バックオフを使用して再試行
   - 持続的なエラーの場合は、ユーザーに通知し、後で再開できるようにコンテキストを保存

## まとめ

このAPIを使用することで、あなた（AI）はMCPとして効率的にタスクを管理・実行できます。ユーザーの優先順位に従ってタスクを処理し、進捗を報告することで、ユーザーの生産性向上に貢献できます。

APIの詳細な仕様やデータモデルについては、`JSON_SPEC.md` を参照してください。